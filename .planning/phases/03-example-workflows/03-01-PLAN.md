---
phase: 03-example-workflows
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - directives/csv_to_json.md
  - execution/csv_to_json.py
  - data/sample.csv
autonomous: true

must_haves:
  truths:
    - "User can convert a CSV file to JSON with a single command"
    - "Running without arguments shows helpful usage message"
    - "Missing input file produces clear error, not stack trace"
    - "Output can go to stdout or file via --output flag"
  artifacts:
    - path: "directives/csv_to_json.md"
      provides: "Directive with trigger phrases and usage"
      contains: "DOE-VERSION: 2026.01.23"
    - path: "execution/csv_to_json.py"
      provides: "Script that converts CSV to JSON"
      contains: "DOE_VERSION = \"2026.01.23\""
    - path: "data/sample.csv"
      provides: "Sample CSV for immediate testing"
      min_lines: 3
  key_links:
    - from: "directives/csv_to_json.md"
      to: "execution/csv_to_json.py"
      via: "version tag sync"
      pattern: "DOE.VERSION.*2026\\.01\\.23"
---

<objective>
Create a simple file utility workflow (CSV to JSON converter) that demonstrates the directive + script pattern without requiring any external API or special setup.

Purpose: Teach the basic DOE workflow pattern (directive + script + version sync) without API complexity.
Output: Working example that can be run immediately after cloning the repository.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-example-workflows/03-RESEARCH.md
@directives/_TEMPLATE.md
@execution/_TEMPLATE.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CSV to JSON directive</name>
  <files>directives/csv_to_json.md</files>
  <action>
Create directive following _TEMPLATE.md structure:

```markdown
# CSV to JSON Converter
<!-- DOE-VERSION: 2026.01.23 -->

## Goal

Convert CSV files to JSON format. Useful for data transformation, API preparation, or format conversion.

---

## Trigger Phrases

**Matches:**
- "convert csv to json"
- "csv to json"
- "transform csv file"

---

## Quick Start

```bash
python execution/csv_to_json.py data/sample.csv
python execution/csv_to_json.py input.csv --output output.json
```

---

## What It Does

1. **Read** — Loads the CSV file using Python's csv module
2. **Convert** — Transforms rows into JSON objects (headers become keys)
3. **Output** — Prints to stdout or writes to file if --output specified

---

## Output

**Deliverable:** JSON array of objects, one per CSV row
**Location:** stdout (default) or file specified by --output

---

## CLI Arguments

| Argument | Default | Description |
|----------|---------|-------------|
| `input` | (required) | Path to input CSV file |
| `--output` | stdout | Path to output JSON file |

---

## Edge Cases

### Empty CSV
**Fix:** Outputs empty JSON array `[]`

### Missing Headers
**Fix:** First row is always treated as headers

---

## Changelog

### 2026.01.23
- Created
```
  </action>
  <verify>cat directives/csv_to_json.md | grep "DOE-VERSION: 2026.01.23"</verify>
  <done>Directive exists with correct version tag and all required sections</done>
</task>

<task type="auto">
  <name>Task 2: Create CSV to JSON script</name>
  <files>execution/csv_to_json.py</files>
  <action>
Create script following _TEMPLATE.py structure but simpler (no API key needed):

```python
#!/usr/bin/env python3
"""
Convert CSV file to JSON format.

Directive: directives/csv_to_json.md

Usage:
    python execution/csv_to_json.py data/sample.csv
    python execution/csv_to_json.py input.csv --output output.json
"""

import csv
import json
import sys
import argparse
from pathlib import Path

# =============================================================================
# VERSION - Must match directive
# =============================================================================
DOE_VERSION = "2026.01.23"


def main():
    parser = argparse.ArgumentParser(
        description="Convert CSV file to JSON format"
    )
    parser.add_argument("input", help="Input CSV file path")
    parser.add_argument(
        "--output", "-o",
        help="Output JSON file (default: print to stdout)"
    )
    args = parser.parse_args()

    # Validate input file exists
    input_path = Path(args.input)
    if not input_path.exists():
        print(f"ERROR: File not found: {args.input}")
        return 1

    if not input_path.suffix.lower() == '.csv':
        print(f"WARNING: File does not have .csv extension: {args.input}")

    try:
        # Read CSV
        with open(input_path, 'r', newline='', encoding='utf-8') as csvfile:
            reader = csv.DictReader(csvfile)
            data = list(reader)

        # Convert to JSON
        json_output = json.dumps(data, indent=2, ensure_ascii=False)

        # Output
        if args.output:
            output_path = Path(args.output)
            output_path.parent.mkdir(parents=True, exist_ok=True)
            output_path.write_text(json_output, encoding='utf-8')
            print(f"Converted {len(data)} rows to JSON")
            print(f"Output: {args.output}")
        else:
            print(json_output)

        return 0

    except csv.Error as e:
        print(f"CSV Error: {e}")
        return 1
    except Exception as e:
        print(f"Error: {e}")
        return 1


if __name__ == "__main__":
    sys.exit(main())
```

Key differences from template:
- No dotenv/API key (file utility doesn't need it)
- Simple, focused implementation
- Clear error messages for missing file
- Supports both stdout and file output
  </action>
  <verify>python execution/csv_to_json.py --help</verify>
  <done>Script runs and shows help text without errors</done>
</task>

<task type="auto">
  <name>Task 3: Create sample CSV data file</name>
  <files>data/sample.csv</files>
  <action>
Create `data/` directory and sample.csv with simple, universally understandable data:

```csv
name,email,role
Alice Smith,alice@example.com,Developer
Bob Jones,bob@example.com,Designer
Carol White,carol@example.com,Manager
```

Why this data:
- 3 rows (minimal but demonstrates the pattern)
- Common field names (name, email, role)
- No special characters or edge cases
- Immediately understandable
  </action>
  <verify>python execution/csv_to_json.py data/sample.csv</verify>
  <done>Script converts sample.csv to JSON and outputs valid JSON array</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Version sync check:
```bash
grep "DOE-VERSION: 2026.01.23" directives/csv_to_json.md
grep "DOE_VERSION = \"2026.01.23\"" execution/csv_to_json.py
```

2. Functional test:
```bash
python execution/csv_to_json.py data/sample.csv
python execution/csv_to_json.py data/sample.csv --output .tmp/test_output.json
cat .tmp/test_output.json
```

3. Error handling test:
```bash
python execution/csv_to_json.py nonexistent.csv  # Should show "File not found"
```
</verification>

<success_criteria>
1. `python execution/csv_to_json.py data/sample.csv` outputs valid JSON
2. `python execution/csv_to_json.py data/sample.csv --output test.json` creates file
3. `python execution/csv_to_json.py missing.csv` shows clear error message
4. Version tags match between directive (DOE-VERSION) and script (DOE_VERSION)
5. Directive has trigger phrases that match common user requests
</success_criteria>

<output>
After completion, create `.planning/phases/03-example-workflows/03-01-SUMMARY.md`
</output>
