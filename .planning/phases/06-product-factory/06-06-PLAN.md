---
phase: 06-product-factory
plan: 06
type: execute
wave: 4
depends_on: ["06-05"]
files_modified:
  - execution/product_factory.py
  - directives/product_factory.md
  - tests/test_product_factory.py
autonomous: true

must_haves:
  truths:
    - "Product factory orchestrates end-to-end: pain point -> product package"
    - "CLI supports --pain-point OR --product-type with product spec"
    - "Output is complete package in output/products/[id]/ ready to sell"
    - "DOE directive and script versions match"
  artifacts:
    - path: "execution/product_factory.py"
      provides: "Complete product factory orchestrator with CLI"
      exports: ["ProductFactory", "main"]
    - path: "directives/product_factory.md"
      provides: "DOE directive for product creation workflow"
      contains: "DOE-VERSION: 2026.01.31"
  key_links:
    - from: "execution/product_factory.py"
      to: "execution/pain_point_miner.py"
      via: "imports pain point search"
      pattern: "from execution.pain_point_miner import"
    - from: "execution/product_factory.py"
      to: "execution/product_packager.py"
      via: "imports ProductPackager"
      pattern: "from execution.product_packager import"
    - from: "directives/product_factory.md"
      to: "execution/product_factory.py"
      via: "DOE version match"
      pattern: "DOE-VERSION"
---

<objective>
Create the Product Factory orchestrator and DOE directive - the main entry point that ties everything together.

Purpose: Provide CLI interface for end-to-end product creation from pain point research to packaged product.
Output: Working orchestrator with CLI and matching DOE directive.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-product-factory/06-RESEARCH.md
@.planning/phases/06-product-factory/06-05-SUMMARY.md
@execution/pain_point_miner.py
@execution/product_packager.py
@directives/content_aggregate.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create product factory orchestrator</name>
  <files>execution/product_factory.py, tests/test_product_factory.py</files>
  <action>
Create execution/product_factory.py:

1. Import argparse, json, logging
2. Import pain_point_miner functions
3. Import ProductPackager, ProductSpec from relevant modules
4. Import ClaudeClient from claude_client

5. Add DOE-VERSION comment:
   ```python
   """
   Product Factory - Generate high-value digital products from e-commerce pain points.
   DOE-VERSION: 2026.01.31
   
   Usage:
     python execution/product_factory.py --discover  # Find pain points
     python execution/product_factory.py --create --type html_tool --name "Profit Calculator" --problem "..."
   """
   ```

6. ProductFactory class:
   - __init__(self, claude_client=None, output_dir="output/products"):
     - Initializes pain point miner, product packager
   - discover_pain_points(limit=20) -> list[dict]:
     - Uses pain_point_miner to find top pain points
     - Adds suggested product types to each
     - Returns ranked list with recommendations
   - create_product(
       product_type: str,
       solution_name: str,
       problem: str,
       target_audience: str,
       key_benefits: list[str]
     ) -> dict:
     - Creates ProductSpec from inputs
     - Uses ProductPackager to create complete package
     - Returns package result with path, manifest, etc.
   - from_pain_point(pain_point: dict, product_type: str = None) -> dict:
     - Extracts problem from pain point
     - Auto-suggests product type if not provided
     - Calls create_product
   - _suggest_product_type(pain_point: dict) -> str:
     - Based on category and keywords, suggests best product type
     - shipping/inventory -> automation
     - conversion/pricing -> html_tool (calculator)
     - general -> prompt_pack or pdf

7. CLI with argparse:
   - `--discover`: Run pain point discovery, output top 20
   - `--create`: Create a product (requires --type, --name, --problem)
   - `--type`: Product type (html_tool, automation, gpt_config, sheets, pdf, prompt_pack)
   - `--name`: Product name
   - `--problem`: Problem being solved
   - `--audience`: Target audience (default: "E-commerce entrepreneurs")
   - `--benefits`: Comma-separated benefits list
   - `--from-pain-point`: JSON file with pain point data
   - `--output-dir`: Override output directory
   - `--verbose`: Enable verbose logging

8. main() function:
   - Parses args
   - Runs discovery or creation based on flags
   - Prints results in clean format

Create tests/test_product_factory.py:
- Test ProductFactory can be instantiated
- Test discover_pain_points returns list with suggestions
- Test create_product calls PackageProduct
- Test from_pain_point extracts problem correctly
- Test _suggest_product_type logic for different categories
- Test CLI parses --discover correctly
- Test CLI parses --create with all required args
- Test CLI fails gracefully with missing args
- Mock all external dependencies
  </action>
  <verify>pytest tests/test_product_factory.py -v passes with 9+ tests</verify>
  <done>Product factory orchestrates end-to-end product creation with CLI</done>
</task>

<task type="auto">
  <name>Task 2: Create DOE directive</name>
  <files>directives/product_factory.md</files>
  <action>
Create directives/product_factory.md following DOE format:

```markdown
# Product Factory
<!-- DOE-VERSION: 2026.01.31 -->

## Goal
Generate high-value digital products ($1K+ perceived value) from e-commerce pain points.

## Trigger Phrases
- "create a product"
- "find pain points"
- "generate product from problem"
- "make a calculator for"
- "build an automation for"

## Quick Start

### Discover Pain Points
```bash
python execution/product_factory.py --discover
```

### Create Product from Pain Point
```bash
python execution/product_factory.py --create \
  --type html_tool \
  --name "Shopify Profit Calculator" \
  --problem "E-com owners don't know their true profit margins" \
  --audience "Shopify store owners doing \$10K-100K/mo" \
  --benefits "Know real profit in 30 seconds,Spot margin leaks instantly,Price products confidently"
```

### Create from Pain Point File
```bash
python execution/product_factory.py --from-pain-point data/pain_points/conversion_rate.json --type html_tool
```

## What It Does

1. **Discover Phase** (--discover):
   - Searches Reddit for e-commerce pain points
   - Scores by engagement (upvotes + comments = real pain)
   - Categorizes: shipping, inventory, conversion, returns, pricing, marketing
   - Suggests product types for each pain point

2. **Create Phase** (--create):
   - Generates product using appropriate generator
   - Creates sales copy with Hormozi/Suby voice
   - Recommends pricing ($27-97 based on type)
   - Packages everything in output/products/[id]/

## Product Types

| Type | What It Creates | Price Range | Best For |
|------|-----------------|-------------|----------|
| html_tool | Single-file calculator/generator | $27-47 | Calculators, generators |
| automation | Python script + docs | $47-97 | Workflow automation |
| gpt_config | GPT instructions + setup guide | $27-47 | AI assistants |
| sheets | Google Sheets template + backup | $27-47 | Trackers, dashboards |
| pdf | Styled PDF framework | $17-37 | Guides, frameworks |
| prompt_pack | Curated prompts + examples | $17-27 | Prompt collections |

## Output

Each product package includes:
- `deliverable/` - The actual product files
- `sales_copy.md` - Ready-to-use sales page copy
- `manifest.json` - Product metadata + pricing
- `[product].zip` - Downloadable package

Location: `output/products/[product-id]/`

## Configuration

Environment variables:
- `ANTHROPIC_API_KEY` - Required for Claude generation
- `REDDIT_CLIENT_ID`, `REDDIT_CLIENT_SECRET`, `REDDIT_USER_AGENT` - For pain point discovery
- `GOOGLE_SERVICE_ACCOUNT_JSON` - Optional, for Google Sheets online mode

## Success Criteria

1. Pain points are specific, not vague ("conversion rate low" not "struggling")
2. Products solve ONE narrow problem clearly
3. Sales copy follows Hormozi/Suby voice (no fluff)
4. Price includes perceived value justification
5. Package is complete and ready to sell
```
  </action>
  <verify>cat directives/product_factory.md | grep "DOE-VERSION: 2026.01.31" returns match</verify>
  <done>DOE directive documents the product factory workflow with matching version</done>
</task>

</tasks>

<verification>
1. `pytest tests/test_product_factory.py -v` - All tests pass
2. `python execution/product_factory.py --help` - Shows CLI usage
3. `grep "DOE-VERSION" execution/product_factory.py directives/product_factory.md` - Both show 2026.01.31
4. Verify directive has all required DOE sections (Goal, Trigger Phrases, Quick Start, What It Does, Output)
</verification>

<success_criteria>
1. Product factory CLI supports --discover and --create workflows
2. End-to-end flow works: pain point -> product package
3. DOE directive and script versions match (2026.01.31)
4. Output is complete package in output/products/[id]/
5. All phase requirements covered (PROD-01 through PROD-12, AGGR-10)
</success_criteria>

<output>
After completion, create `.planning/phases/06-product-factory/06-06-SUMMARY.md`
</output>
