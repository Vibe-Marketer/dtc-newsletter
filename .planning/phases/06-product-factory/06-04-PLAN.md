---
phase: 06-product-factory
plan: 04
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - execution/generators/pdf.py
  - execution/generators/sheets.py
  - tests/test_pdf_generator.py
  - tests/test_sheets_generator.py
autonomous: true
user_setup:
  - service: google-sheets
    why: "Google Sheets API for template creation"
    env_vars:
      - name: GOOGLE_SERVICE_ACCOUNT_JSON
        source: "Google Cloud Console -> APIs & Services -> Credentials -> Service Account -> JSON key"
    dashboard_config:
      - task: "Enable Sheets API and Drive API"
        location: "Google Cloud Console -> APIs & Services -> Enable APIs"

must_haves:
  truths:
    - "PDFs generate with professional styling using fpdf2"
    - "PDFs include chapters, sections, and formatted content"
    - "Sheets templates include formulas and conditional formatting"
    - "Sheets are shareable via link (anyone with link can copy)"
  artifacts:
    - path: "execution/generators/pdf.py"
      provides: "PDF framework/guide generator"
      exports: ["PdfGenerator"]
    - path: "execution/generators/sheets.py"
      provides: "Google Sheets template generator"
      exports: ["SheetsGenerator"]
  key_links:
    - from: "execution/generators/pdf.py"
      to: "fpdf2"
      via: "from fpdf import FPDF"
      pattern: "from fpdf import"
    - from: "execution/generators/sheets.py"
      to: "gspread"
      via: "import gspread"
      pattern: "import gspread"
---

<objective>
Create PDF and Google Sheets generators - product types that require external library integrations (fpdf2, gspread).

Purpose: Generate professional PDF frameworks/guides and functional Google Sheets templates.
Output: Two generators with external library integration and tests.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-product-factory/06-RESEARCH.md
@.planning/phases/06-product-factory/06-01-SUMMARY.md
@execution/generators/base_generator.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PDF generator with fpdf2</name>
  <files>execution/generators/pdf.py, tests/test_pdf_generator.py</files>
  <action>
First, ensure fpdf2 is in requirements:
- Add `fpdf2>=2.8.0` to requirements.txt if not present
- Run `pip install fpdf2` to install

Create execution/generators/pdf.py:

1. Import fpdf.FPDF, BaseGenerator, ProductSpec, GeneratedProduct

2. Define FrameworkPDF(FPDF) class:
   - header(): Set font to Helvetica Bold 15pt, center title, add line
   - footer(): Page number at bottom "Page X of Y"
   - chapter_title(title: str): Bold 12pt, light blue background fill
   - chapter_body(body: str): Times 12pt, multi_cell with proper spacing
   - bullet_list(items: list[str]): Formatted bullet points
   - numbered_list(items: list[str]): Numbered list
   - callout_box(text: str, type: str): Styled box for tips, warnings, notes

3. Define PDF_CONTENT_PROMPT for Claude to generate framework content:
   - Takes problem, solution_name, target_audience
   - Outputs structured JSON with:
     - title: Framework title
     - subtitle: Short description
     - sections: list of {title: str, type: "text"|"bullets"|"numbered"|"callout", content: str|list}

4. PdfGenerator(BaseGenerator):
   - __init__(self, claude_client=None)
   - get_product_type() -> "pdf"
   - generate(spec: ProductSpec) -> GeneratedProduct:
     - Uses Claude to generate framework content structure
     - Renders PDF using FrameworkPDF
     - Returns GeneratedProduct with files:
       - "[name].pdf": The PDF bytes
       - "README.md": What's in the PDF, how to use
   - validate(product: GeneratedProduct) -> bool:
     - Checks PDF file exists
     - Checks PDF is valid (starts with %PDF)
     - Checks PDF is > 1KB (not empty)
   - _render_pdf(content: dict) -> bytes:
     - Creates FrameworkPDF, adds content, returns output bytes

Create tests/test_pdf_generator.py:
- Test generator inherits from BaseGenerator
- Test get_product_type returns "pdf"
- Test FrameworkPDF can be instantiated
- Test chapter_title adds content to PDF
- Test generate produces .pdf file
- Test validate catches empty PDF
- Test validate catches non-PDF content
- Test PDF output starts with %PDF
- Mock Claude for content generation
  </action>
  <verify>pytest tests/test_pdf_generator.py -v passes with 8+ tests</verify>
  <done>PDF generator creates professional styled frameworks using fpdf2</done>
</task>

<task type="auto">
  <name>Task 2: Create Sheets generator with gspread</name>
  <files>execution/generators/sheets.py, tests/test_sheets_generator.py</files>
  <action>
First, ensure gspread is in requirements:
- Add `gspread>=6.0.0` and `google-auth>=2.0.0` to requirements.txt if not present
- Run `pip install gspread google-auth` to install

Create execution/generators/sheets.py:

1. Import gspread, google.oauth2.service_account.Credentials, json, os
2. Import BaseGenerator, ProductSpec, GeneratedProduct

3. Define SCOPES for Google API:
   - https://www.googleapis.com/auth/spreadsheets
   - https://www.googleapis.com/auth/drive

4. Define SHEETS_CONTENT_PROMPT for Claude to generate sheet structure:
   - Takes problem, solution_name, target_audience
   - Outputs structured JSON with:
     - title: Sheet title
     - worksheets: list of {name: str, headers: list[str], formulas: dict[cell, formula], sample_data: list[list]}

5. SheetsGenerator(BaseGenerator):
   - __init__(self, claude_client=None, credentials_path=None):
     - credentials_path defaults to env var GOOGLE_SERVICE_ACCOUNT_JSON or "service_account.json"
   - get_product_type() -> "sheets"
   - generate(spec: ProductSpec) -> GeneratedProduct:
     - If no credentials available, generate OFFLINE mode:
       - Return sheet definition JSON + instructions for manual creation
     - If credentials available:
       - Create sheet via gspread
       - Set permissions (anyone with link can view)
       - Return URL and backup JSON definition
     - Files:
       - "sheet_definition.json": Full structure (for offline/backup)
       - "README.md": How to use, link if online
       - "MANUAL_SETUP.md": Instructions to recreate manually
   - validate(product: GeneratedProduct) -> bool:
     - Checks sheet_definition.json exists
     - Checks at least one worksheet defined
     - Checks headers are present
   - _get_client() -> gspread.Client or None:
     - Returns authenticated client or None if no creds
   - _create_sheet_online(structure: dict) -> str:
     - Creates sheet, returns URL
   - _generate_manual_instructions(structure: dict) -> str:
     - Step-by-step to recreate manually

Create tests/test_sheets_generator.py:
- Test generator inherits from BaseGenerator
- Test get_product_type returns "sheets"
- Test generate works in offline mode (no credentials)
- Test offline mode produces sheet_definition.json
- Test validate catches missing worksheets
- Test manual setup instructions are generated
- Mock gspread for online mode tests
- Test SCOPES are correct
  </action>
  <verify>pytest tests/test_sheets_generator.py -v passes with 8+ tests</verify>
  <done>Sheets generator creates Google Sheets templates with offline fallback</done>
</task>

</tasks>

<verification>
1. `pytest tests/test_pdf_generator.py tests/test_sheets_generator.py -v` - All tests pass
2. `python -c "from execution.generators.pdf import PdfGenerator"` - Import works
3. `python -c "from execution.generators.sheets import SheetsGenerator"` - Import works
4. `pip list | grep -E "fpdf2|gspread"` - Dependencies installed
</verification>

<success_criteria>
1. PDF generator creates professional styled frameworks using fpdf2
2. Sheets generator works in both online and offline modes
3. Sheets has graceful fallback when credentials unavailable
4. Both include documentation
5. 16+ tests passing for external-dependency generators
</success_criteria>

<output>
After completion, create `.planning/phases/06-product-factory/06-04-SUMMARY.md`
</output>
